syntax = "proto3";

package worker;

option go_package = "./workerpb;workerpb";

// Request from Load Generator
message WorkRequest {
  int32 duration_ms = 1; // CPU spin duration in milliseconds
  string work_mode = 2; // Work mode: "full" (default) or "echo"
}

// Response from Worker
message WorkResponse {
  string status = 1;
  int64 e2e_latency_ms = 2;
  int64 avg_cpu_freq_khz = 3; // Average CPU frequency (in kHz)
  int64 iterations = 4; // number of busy-spin loops iterated
  
  // High-precision timestamps for data plane latency analysis
  int64 arrival_timestamp_ns = 5; // Request arrival time (nanoseconds since epoch)
  int64 pre_busy_timestamp_ns = 6; // Time before busy work starts
  int64 post_busy_timestamp_ns = 7; // Time after busy work completes
  int64 response_timestamp_ns = 8; // Time when response is sent
  int64 worker_processing_ns = 9; // Total worker processing time (post_busy - pre_busy)
}

// Service definition
service WorkerService {
  rpc DoWork(WorkRequest) returns (WorkResponse);
}
